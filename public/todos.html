<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Todos - Research Notebook</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div class="container">
    <header class="site-header">
      <div class="brand">
        <div class="logo">RN</div>
        <div>
          <h1>Todos</h1>
          <p class="lead">Manage your tasks and todos</p>
        </div>
      </div>
      <nav class="nav">
        <a href="/">Home</a>
        <a href="/dashboard.html">Dashboard</a>
        <a href="/note.html">Notes</a>
        <span id="auth-actions"></span>
      </nav>
    </header>

    <div class="grid">
      <div class="card">
        <h2>Your Todos</h2>
        <ul id="todos-list" class="todo-list"></ul>
      </div>

      <div class="card">
        <h3>Create New Todo</h3>
        <form id="create-form" class="stack">
          <div>
            <label for="title">Title</label>
            <input id="title" type="text" placeholder="Enter todo title..." required />
          </div>
          <div>
            <label for="description">Description</label>
            <textarea id="description" placeholder="Add details..." rows="4"></textarea>
          </div>
          <button class="btn btn-primary" type="submit">Create Todo</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal for editing todos -->
  <div id="modal-overlay" class="modal-overlay hidden">
    <div class="modal">
      <h3>Edit Todo</h3>
      <form id="modal-form" class="modal-form">
        <div>
          <label for="modal-title-input">Title</label>
          <input id="modal-title-input" type="text" required />
        </div>
        <div>
          <label for="modal-description">Description</label>
          <textarea id="modal-description" rows="4"></textarea>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" id="modal-cancel">Cancel</button>
          <button type="submit" class="btn btn-primary" id="modal-save">Save Changes</button>
        </div>
      </form>
    </div>
  </div>

  <script src="/app.js"></script>
  <script>
    async function createHandler(e){
      e.preventDefault();
      const titleEl = document.getElementById('title');
      const descEl = document.getElementById('description');
      const title = titleEl.value.trim();
      const description = descEl.value.trim();
      if (!title) { showToast('Title required', 'error', 1800); return; }
      try{
        const btn = document.getElementById('create-form').querySelector('button[type=submit]');
        btn.disabled = true;
        await api.request('/api/todos',{method:'POST', body:{title,description}});
        titleEl.value = '';
        descEl.value = '';
        showToast('Todo created!', 'success', 1200);
        await loadTodos();
        btn.disabled = false;
      }catch(err){
        console.warn('create todo failed', err);
        showToast('Create failed: ' + (err && (err.error || JSON.stringify(err))), 'error', 3000);
        document.getElementById('create-form').querySelector('button[type=submit]').disabled = false;
      }
    }
    document.getElementById('create-form').addEventListener('submit', createHandler);
    async function loadTodos(){
      const list = document.getElementById('todos-list');
      if (list) list.innerHTML = '<li class="muted">Loading...</li>';
      await loadTodosList();
    }
  </script>
</body>
</html>
