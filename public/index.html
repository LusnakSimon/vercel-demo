<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Collaborative Research Notebook</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div class="container">
    <header class="site-header">
      <div class="brand">
        <div class="logo">RN</div>
        <div>
          <h1>Research Notebook</h1>
          <p class="lead">Collaborative research and note-taking platform</p>
        </div>
      </div>
      <nav class="nav">
        <a href="/dashboard.html">Dashboard</a>
        <a href="/projects.html">Projects</a>
        <a href="/todos.html">Todos</a>
        <a href="/notes.html">Notes</a>
        <a href="/contacts.html">Contacts</a>
        <button id="theme-toggle" title="Toggle theme">ðŸŒ™</button>
        <span id="auth-actions"></span>
      </nav>
    </header>

    <div class="hero">
      <h2>Welcome to Research Notebook</h2>
      <p>Create and organize research notes, todos, and projects all in one place.</p>
      <div style="display: flex; gap: 12px; justify-content: center; margin-top: 24px;" id="hero-actions">
        <a href="/register.html" class="btn btn-primary">Get Started</a>
        <a href="/login.html" class="btn btn-secondary">Sign In</a>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <h3>Quick Start</h3>
        <p class="muted">Add a todo to get started. Your todos are saved to the database and synced across devices.</p>

        <form id="todo-form" class="stack" style="margin-top:20px">
          <div>
            <label for="todo-input">New Todo</label>
            <input id="todo-input" type="text" placeholder="Enter todo title..." aria-label="New todo title" />
          </div>
          <button type="submit" class="btn btn-primary">Add Todo</button>
        </form>

        <ul id="todo-list" class="todo-list" style="margin-top:24px"></ul>
      </div>

      <div class="card">
        <h3>API Endpoints</h3>
        <p class="muted">Explore the available API routes</p>
        <div class="stack" style="margin-top:20px">
          <a href="/api/health" class="btn btn-secondary" target="_blank">Health Check</a>
          <a href="/api/todos" class="btn btn-secondary" target="_blank">Todos API</a>
          <a href="/api/notes" class="btn btn-secondary" target="_blank">Notes API</a>
        </div>
      </div>
    </div>

    <footer class="footer">
      <p>Collaborative Research Notebook &copy; 2025</p>
    </footer>
  </div>

  <script src="/app.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', async ()=>{
      renderAuthActions();
      
      // Hide hero auth buttons if already logged in
      try {
        const res = await api.request('/api/auth/me');
        if (res && res.user) {
          const heroActions = document.getElementById('hero-actions');
          if (heroActions) {
            heroActions.innerHTML = '<a href="/dashboard.html" class="btn btn-primary">Go to Dashboard</a>';
          }
        }
      } catch(e) {
        // Not logged in, keep the default buttons
      }
      
      const form = document.getElementById('todo-form');
      form.addEventListener('submit', async (ev)=>{
        ev.preventDefault();
        const input = document.getElementById('todo-input');
        const title = (input.value||'').trim(); 
        if(!title) return;
        try{
          await api.request('/api/todos', { method: 'POST', body: { title } });
          input.value='';
          loadTodosList();
          showToast('Todo added!', 'success');
        }catch(e){ 
          showToast('Please sign in to create todos', 'error');
        }
      });
      loadTodosList();
    });
  </script>
</body>
</html>